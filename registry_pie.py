import matplotlib.pyplot as plt

def plot_registry_operations_pie(event_counts):
    # Extract the keys (event types) and their counts
    events = list(event_counts.keys())
    counts = list(event_counts.values())
    total = sum(counts)

    # Calculate percentages
    percentages = [(count/total)*100 for count in counts]
    
    # Create labels for the legend which include the operation and percentage
    labels_with_percentages = [f'{event} ({percentage:.2f}%)' for event, percentage in zip(events, percentages)]
    
    # Create a pie chart
    fig, ax = plt.subplots(figsize=(10,6))
    wedges = ax.pie(counts, startangle=90, colors=plt.cm.Paired.colors, wedgeprops=dict(width=0.4))

    # Draw a circle at the center of pie to make it look like a donut
    centre_circle = plt.Circle((0,0),0.70,fc='white')
    fig.gca().add_artist(centre_circle)

    # Set the title
    ax.set_title('Registry Operations Distribution')
    
    # Position the labels outside of the pie using legend
    ax.legend(wedges[0], labels_with_percentages, title="Registry Operations", loc="center left", bbox_to_anchor=(1, 0, 0.5, 1))
    
    # Save the chart as an image
    registry_operations_pie = r'reports\registry_pie.png'
    plt.savefig(registry_operations_pie, bbox_inches='tight')  # bbox_inches='tight' to fit the legend in the saved image
    # Optionally display the chart
    #plt.show()
    plt.close()

    return registry_operations_pie


